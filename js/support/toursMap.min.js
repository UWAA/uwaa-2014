function isSecure(){return"https:"==location.protocol}function finishedLoading(){loader.className="done",setTimeout(function(){loader.className="hide"},100)}mapboxgl.accessToken="pk.eyJ1IjoiYnBlcmljayIsImEiOiJrT2xBSUNzIn0.n-CVAwFlqHGqkiDUxsIdSQ";var map=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/light-v10",center:[0,0],zoom:.5,renderWorldCopies:!1,fadeDuration:0}),nav=new mapboxgl.NavigationControl({showCompass:!1,showZoom:!0});map.addControl(nav,"top-left");var endPoint=homeLink.endpointURL;map.on("styledata",finishedLoading),map.on("load",function(){map.loadImage("https://a.tiles.mapbox.com/v4/marker/pin-m+4b2e83.png?access_token=pk.eyJ1IjoiYnBlcmljayIsImEiOiJrT2xBSUNzIn0.n-CVAwFlqHGqkiDUxsIdSQ",function(a,b){if(a)throw a;map.addImage("marker",b),map.addSource("tours",{type:"geojson",data:endPoint,cluster:!0,clusterMaxZoom:12,clusterRadius:40}),map.addLayer({id:"clusters",type:"circle",source:"tours",filter:["has","point_count"],paint:{"circle-color":["step",["get","point_count"],"#b7a57a",10,"#85754d"],"circle-radius":["step",["get","point_count"],25,10,30]}}),map.addLayer({id:"cluster-count",type:"symbol",source:"tours",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":16,"text-allow-overlap":!0},paint:{"text-color":"#fff"}}),map.addLayer({id:"unclustered-point",type:"symbol",source:"tours",filter:["!",["has","point_count"]],layout:{"icon-image":"marker","icon-size":1,"icon-allow-overlap":!0}})})}),map.on("click","clusters",function(a){var b=map.queryRenderedFeatures(a.point,{layers:["clusters"]}),c=b[0].properties.cluster_id;map.getSource("tours").getClusterExpansionZoom(c,function(a,c){a||map.easeTo({center:b[0].geometry.coordinates,zoom:c})})}),map.on("mouseenter","clusters",function(){map.getCanvas().style.cursor="pointer"}),map.on("mouseleave","clusters",function(){map.getCanvas().style.cursor=""});var popup=new mapboxgl.Popup({closeButton:!0,closeOnClick:!1});if(map.on("mouseenter","unclustered-point",function(a){map.getCanvas().style.cursor="pointer"}),map.on("click","unclustered-point",function(a){map.getCanvas().style.cursor="pointer";var b=a.features[0].geometry.coordinates.slice();if("preliminary"===a.features[0].properties.preliminary)var c='<p class="map-title">'+a.features[0].properties.title+'</p><p class="map-date">'+a.features[0].properties.date+'</p><p class="map-excerpt">'+a.features[0].properties.excerpt+"</p>";else var c='<a href="'+a.features[0].properties.link+'"><p class="map-title">'+a.features[0].properties.title+'</p><p class="map-date">'+a.features[0].properties.date+'</p><p class="map-excerpt">'+a.features[0].properties.excerpt+'<a class="map-link" href="'+a.features[0].properties.link+'"></a></p></a>';for(;Math.abs(a.lngLat.lng-b[0])>180;)b[0]+=a.lngLat.lng>b[0]?360:-360;(new mapboxgl.Popup).setLngLat(b).setHTML(c).addTo(map)}),map.on("mouseleave","unclustered-point",function(){map.getCanvas().style.cursor=""}),isSecure())var endPoint=endPoint.replace(/^http:\/\//i,"https://");