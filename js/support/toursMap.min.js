function isSecure(){return"https:"==location.protocol}function finishedLoading(){loader.className="done",setTimeout(function(){loader.className="hide"},100)}mapboxgl.accessToken="pk.eyJ1IjoiYnBlcmljayIsImEiOiJrT2xBSUNzIn0.n-CVAwFlqHGqkiDUxsIdSQ";var map=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/light-v10",center:[0,0],zoom:.5,renderWorldCopies:!1});map.addControl(new mapboxgl.NavigationControl);var endPoint=homeLink.endpointURL;map.on("load",function(){map.addSource("tours",{type:"geojson",data:endPoint,cluster:!0,clusterMaxZoom:12,clusterRadius:50}),map.on("render",finishedLoading),map.addLayer({id:"clusters",type:"circle",source:"tours",filter:["has","point_count"],paint:{"circle-color":["step",["get","point_count"],"#f0ddaf",4,"#b7a57a",7,"#99875b"],"circle-radius":["step",["get","point_count"],15,4,20,7,25]}}),map.addLayer({id:"cluster-count",type:"symbol",source:"tours",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["Open Sans Regular","Arial Unicode MS Bold"],"text-size":14}}),map.addLayer({id:"unclustered-point",type:"circle",source:"tours",filter:["!",["has","point_count"]],paint:{"circle-color":"#4b2e83","circle-radius":8}}),map.on("click","clusters",function(a){var b=map.queryRenderedFeatures(a.point,{layers:["clusters"]}),c=b[0].properties.cluster_id;map.getSource("tours").getClusterExpansionZoom(c,function(a,c){a||map.easeTo({center:b[0].geometry.coordinates,zoom:c})})}),map.on("mouseenter","clusters",function(){map.getCanvas().style.cursor="pointer"}),map.on("mouseleave","clusters",function(){map.getCanvas().style.cursor=""})});var popup=new mapboxgl.Popup({closeButton:!1,closeOnClick:!1});if(map.on("mouseenter","unclustered-point",function(a){map.getCanvas().style.cursor="pointer";var b=a.features[0].geometry.coordinates.slice();if("preliminary"===a.features[0].properties.preliminary)var c='<p class="map-title">'+a.features[0].properties.title+'</p><p class="map-date">'+a.features[0].properties.date+'</p><p class="map-excerpt">'+a.features[0].properties.excerpt+"</p>";else var c='<a href="'+a.features[0].properties.link+'"><p class="map-title">'+a.features[0].properties.title+'</p><p class="map-date">'+a.features[0].properties.date+'</p><p class="map-excerpt">'+a.features[0].properties.excerpt+'<a class="map-link" href="'+a.features[0].properties.link+'"></a></p></a>';for(;Math.abs(a.lngLat.lng-b[0])>180;)b[0]+=a.lngLat.lng>b[0]?360:-360;popup.setLngLat(b).setHTML(c).addTo(map)}),map.on("mouseleave","unclustered-point",function(){map.getCanvas().style.cursor="",popup.remove()}),isSecure())var endPoint=endPoint.replace(/^http:\/\//i,"https://");